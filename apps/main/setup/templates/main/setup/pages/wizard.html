{% extends "base.html" %}
{% load static i18n ui djicons %}

{% block title %}ERPlora Hub - {% trans "Setup" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/setup.css' %}">
{% endblock %}

{% block content %}
<div class="setup-container">
    <ion-card class="setup-card">
        <!-- Header -->
        <ion-card-header class="setup-header">
            <img src="{% static 'img/logo.png' %}" alt="ERPlora">
            <ion-card-title>{% trans "Welcome to ERPlora" %}</ion-card-title>
            <ion-card-subtitle>{% trans "Configure your store to get started" %}</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
            <form hx-post="{% url 'setup:wizard' %}"
                  hx-target="#form-errors"
                  hx-swap="innerHTML"
                  hx-indicator="#submit-spinner">

                {% csrf_token %}

                <!-- Error container -->
                <div id="form-errors"></div>

                <!-- Regional Settings Section -->
                <h3 class="section-title">
                    {% icon "globe-outline" %}
                    {% trans "Regional Settings" %}
                </h3>

                <ion-list>
                    <ion-item>
                        <ion-select
                            name="language"
                            label="{% trans 'System Language' %} *"
                            label-placement="floating"
                            value="{{ hub_config.language|default:'en' }}"
                            interface="action-sheet"
                        >
                            {% for code, name in languages %}
                            <ion-select-option value="{{ code }}">{{ name }}</ion-select-option>
                            {% endfor %}
                        </ion-select>
                    </ion-item>

                    <ion-item>
                        <ion-select
                            name="timezone"
                            label="{% trans 'Timezone' %} *"
                            label-placement="floating"
                            value="{{ hub_config.timezone|default:'UTC' }}"
                            interface="action-sheet"
                        >
                            {% for tz in timezones %}
                            <ion-select-option value="{{ tz }}">{{ tz }}</ion-select-option>
                            {% endfor %}
                        </ion-select>
                    </ion-item>
                </ion-list>

                <!-- Business Information Section -->
                <h3 class="section-title">
                    {% icon "business-outline" %}
                    {% trans "Business Information" %}
                </h3>

                <ion-list>
                    <ion-item>
                        <ion-input
                            type="text"
                            name="business_name"
                            label="{% trans 'Business Name' %} *"
                            label-placement="floating"
                            value="{{ store_config.business_name }}"
                            placeholder="{% trans 'Your business name' %}"
                            required
                        ></ion-input>
                    </ion-item>

                    <ion-item>
                        <ion-textarea
                            name="business_address"
                            label="{% trans 'Address' %} *"
                            label-placement="floating"
                            value="{{ store_config.business_address }}"
                            rows="2"
                            placeholder="{% trans 'Street, City, Postal Code' %}"
                            required
                        ></ion-textarea>
                    </ion-item>

                    <ion-item>
                        <ion-input
                            type="text"
                            name="vat_number"
                            label="{% trans 'VAT/Tax ID' %} *"
                            label-placement="floating"
                            value="{{ store_config.vat_number }}"
                            placeholder="{% trans 'e.g., ES12345678A' %}"
                            required
                        ></ion-input>
                    </ion-item>

                    <ion-item>
                        <ion-input
                            type="tel"
                            name="phone"
                            label="{% trans 'Phone' %}"
                            label-placement="floating"
                            value="{{ store_config.phone }}"
                            placeholder="+34 600 000 000"
                        ></ion-input>
                    </ion-item>

                    <ion-item>
                        <ion-input
                            type="email"
                            name="email"
                            label="{% trans 'Email' %}"
                            label-placement="floating"
                            value="{{ store_config.email }}"
                            placeholder="info@business.com"
                        ></ion-input>
                    </ion-item>
                </ion-list>

                <!-- Tax Configuration Section -->
                <h3 class="section-title">
                    {% icon "calculator-outline" %}
                    {% trans "Tax Configuration" %}
                </h3>

                <ion-list>
                    <ion-item>
                        <ion-input
                            type="number"
                            name="tax_rate"
                            label="{% trans 'Default Tax Rate (%)' %}"
                            label-placement="floating"
                            value="{{ store_config.tax_rate|default:'21' }}"
                            placeholder="21"
                            min="0"
                            max="100"
                            step="0.01"
                        ></ion-input>
                    </ion-item>

                    <ion-item>
                        <ion-label>{% trans "Tax included in prices" %}</ion-label>
                        <ion-checkbox
                            slot="end"
                            name="tax_included"
                            {% if store_config.tax_included %}checked{% endif %}
                        ></ion-checkbox>
                    </ion-item>
                </ion-list>

                <p class="setup-form-note">* {% trans "Required fields" %}</p>

                <!-- Submit Button -->
                <div class="setup-submit">
                    <ion-button type="submit" expand="block" size="large">
                        {% icon "checkmark-circle-outline" slot="start" %}
                        {% trans "Complete Setup" %}
                        <ion-spinner id="submit-spinner" name="crescent" class="htmx-indicator" style="margin-left: 8px;"></ion-spinner>
                    </ion-button>
                </div>
            </form>
        </ion-card-content>
    </ion-card>
</div>
{% endblock %}
