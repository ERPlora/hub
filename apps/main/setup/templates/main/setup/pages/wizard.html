{% extends "base.html" %}
{% load static i18n ui djicons %}

{% block title %}ERPlora Hub - {% trans "Setup" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/setup.css' %}">
{% endblock %}

{% block content %}
<div class="setup-container">
    <div class="ux-card setup-card">
        <!-- Header -->
        <div class="ux-card__header setup-header">
            <img src="{% static 'img/logo.png' %}" alt="ERPlora">
            <h3>{% trans "Welcome to ERPlora" %}</h3>
            <p class="ux-text-secondary">{% trans "Configure your store to get started" %}</p>
        </div>

        <div class="ux-card__body">
            <form hx-post="{% url 'setup:wizard' %}"
                  hx-target="#form-errors"
                  hx-swap="innerHTML"
                  hx-indicator="#submit-spinner">

                {% csrf_token %}

                <!-- Error container -->
                <div id="form-errors"></div>

                <!-- Regional Settings Section -->
                <h3 class="section-title">
                    {% icon "globe-outline" %}
                    {% trans "Regional Settings" %}
                </h3>

                <div class="ux-list">
                    <div class="ux-list__item">
                        <label for="language" class="ux-label">{% trans "System Language" %} *</label>
                        <select class="ux-select" name="language" id="language">
                            {% for code, name in languages %}
                            <option value="{{ code }}" {% if hub_config.language == code or code == 'en' and not hub_config.language %}selected{% endif %}>{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="ux-list__item">
                        <label for="timezone" class="ux-label">{% trans "Timezone" %} *</label>
                        <select class="ux-select" name="timezone" id="timezone">
                            {% for tz in timezones %}
                            <option value="{{ tz }}" {% if hub_config.timezone == tz or tz == 'UTC' and not hub_config.timezone %}selected{% endif %}>{{ tz }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Business Information Section -->
                <h3 class="section-title">
                    {% icon "business-outline" %}
                    {% trans "Business Information" %}
                </h3>

                <div class="ux-list">
                    <div class="ux-list__item">
                        <label for="business_name" class="ux-label">{% trans "Business Name" %} *</label>
                        <input class="ux-input"
                            type="text"
                            name="business_name"
                            id="business_name"
                            value="{{ store_config.business_name }}"
                            placeholder="{% trans 'Your business name' %}"
                            required>
                    </div>

                    <div class="ux-list__item">
                        <label for="business_address" class="ux-label">{% trans "Address" %} *</label>
                        <textarea class="ux-textarea"
                            name="business_address"
                            id="business_address"
                            rows="2"
                            placeholder="{% trans 'Street, City, Postal Code' %}"
                            required>{{ store_config.business_address }}</textarea>
                    </div>

                    <div class="ux-list__item">
                        <label for="vat_number" class="ux-label">{% trans "VAT/Tax ID" %} *</label>
                        <input class="ux-input"
                            type="text"
                            name="vat_number"
                            id="vat_number"
                            value="{{ store_config.vat_number }}"
                            placeholder="{% trans 'e.g., ES12345678A' %}"
                            required>
                    </div>

                    <div class="ux-list__item">
                        <label for="phone" class="ux-label">{% trans "Phone" %}</label>
                        <input class="ux-input"
                            type="tel"
                            name="phone"
                            id="phone"
                            value="{{ store_config.phone }}"
                            placeholder="+34 600 000 000">
                    </div>

                    <div class="ux-list__item">
                        <label for="email" class="ux-label">{% trans "Email" %}</label>
                        <input class="ux-input"
                            type="email"
                            name="email"
                            id="email"
                            value="{{ store_config.email }}"
                            placeholder="info@business.com">
                    </div>
                </div>

                <!-- Tax Configuration Section -->
                <h3 class="section-title">
                    {% icon "calculator-outline" %}
                    {% trans "Tax Configuration" %}
                </h3>

                <div class="ux-list">
                    <div class="ux-list__item">
                        <label for="tax_rate" class="ux-label">{% trans "Default Tax Rate (%)" %}</label>
                        <input class="ux-input"
                            type="number"
                            name="tax_rate"
                            id="tax_rate"
                            value="{{ store_config.tax_rate|default:'21' }}"
                            placeholder="21"
                            min="0"
                            max="100"
                            step="0.01">
                    </div>

                    <div class="ux-list__item d-flex justify-between align-center">
                        <span>{% trans "Tax included in prices" %}</span>
                        <input type="checkbox"
                            name="tax_included"
                            {% if store_config.tax_included %}checked{% endif %}>
                    </div>
                </div>

                <p class="setup-form-note">* {% trans "Required fields" %}</p>

                <!-- Submit Button -->
                <div class="setup-submit">
                    <button type="submit" class="ux-button ux-button--block ux-button--lg">
                        {% icon "checkmark-circle-outline" %}
                        {% trans "Complete Setup" %}
                        <div id="submit-spinner" class="ux-spinner htmx-indicator" style="margin-left: 8px;"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
