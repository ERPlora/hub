{% load i18n djicons %}

<script id="modules-data" type="application/json">{{ modules_json|safe }}</script>

<div x-data="moduleGrid">
    <!-- Search -->
    <div class="mb-4">
        <label class="input rounded-full" x-data="{ focused: false }" :class="{ 'input-focused': focused }">
            {% icon "search-outline" css_class="opacity-50" %}
            <input type="search"
                   class="grow"
                   placeholder="{% trans 'Search modules...' %}"
                   x-model="searchQuery"
                   @focus="focused = true"
                   @blur="focused = false">
        </label>
    </div>

    <!-- Module Grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
        <template x-for="mod in filteredModules" :key="mod.id">
            <a class="card card-body items-center text-center gap-2 no-underline text-base-content hover:shadow-md transition-shadow cursor-pointer"
               :href="mod.url"
               :hx-get="mod.url"
               hx-target="#main-content-area"
               hx-push-url="true"
               @click="trackRecent(mod.id)">
                <div class="app-icon" :class="'app-icon-' + mod.color">
                    <template x-if="mod.has_svg && mod.svg_path">
                        <img :src="mod.svg_path" :alt="mod.label" class="w-7 h-7">
                    </template>
                    <template x-if="!mod.has_svg || !mod.svg_path">
                        <span x-html="mod.icon_svg"></span>
                    </template>
                </div>
                <span class="text-sm font-medium" x-text="mod.label"></span>
            </a>
        </template>

        <!-- Get More -->
        <a class="card card-body items-center text-center gap-2 no-underline text-base-content opacity-50 hover:opacity-80 border-2 border-dashed cursor-pointer"
           href="/marketplace/"
           hx-get="/marketplace/"
           hx-target="#main-content-area"
           hx-push-url="true"
           style="background: transparent;">
            <div class="app-icon" style="background: transparent;">
                {% icon "add" size=28 %}
            </div>
            <span class="text-sm font-medium">{% trans "Get More" %}</span>
        </a>
    </div>

    <!-- Empty state -->
    <template x-if="modules.length === 0">
        <div class="flex flex-col items-center text-center py-12">
            {% icon "extension-puzzle-outline" css_class="w-16 h-16 opacity-30 mb-4" %}
            <h3 class="text-lg font-semibold mb-2">{% trans "No modules installed" %}</h3>
            <p class="opacity-60 mb-6">{% trans "Visit the Marketplace to add functionality to your Hub." %}</p>
            <a class="btn color-primary"
               href="/marketplace/"
               hx-get="/marketplace/"
               hx-target="#main-content-area"
               hx-push-url="true">
                {% icon "storefront-outline" %}
                {% trans "Browse Marketplace" %}
            </a>
        </div>
    </template>
</div>
