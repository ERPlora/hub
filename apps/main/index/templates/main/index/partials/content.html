{% load i18n djicons %}

<div x-data="{ searchQuery: '' }">
    {% if alerts %}
    <div class="accordion mb-6">
        {% for alert in alerts %}
        <details class="accordion-item" {% if forloop.first %}open{% endif %}>
            <summary class="accordion-header">
                <span class="accordion-title flex items-center gap-2">
                    {% icon alert.icon %}
                    {{ alert.title }}
                </span>
                <span class="accordion-chevron">{% icon "chevron-down-outline" %}</span>
            </summary>
            <div class="accordion-body">
                <p class="mb-3">{{ alert.description }}</p>
                <a class="btn btn-sm color-{{ alert.color }}"
                   href="{{ alert.link }}"
                   hx-get="{{ alert.link }}"
                   hx-target="#main-content-area"
                   hx-push-url="true">
                    {{ alert.link_text }}
                </a>
            </div>
        </details>
        {% endfor %}
    </div>
    {% endif %}

    {% if modules %}
    <!-- Search -->
    <div class="mb-4">
        <label class="input rounded-full" x-data="{ focused: false }" :class="{ 'input-focused': focused }">
            {% icon "search-outline" css_class="opacity-50" %}
            <input type="search"
                   class="grow"
                   placeholder="{% trans 'Search modules...' %}"
                   x-model="searchQuery"
                   @focus="focused = true"
                   @blur="focused = false">
        </label>
    </div>

    <!-- Module Grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
        {% for mod in modules %}
        <a class="card glass card-body items-center text-center gap-2 no-underline text-base-content hover:shadow-md transition-shadow cursor-pointer"
           href="{{ mod.url }}"
           hx-get="{{ mod.url }}"
           hx-target="#main-content-area"
           hx-push-url="true"
           x-show="!searchQuery || '{{ mod.label|lower }}'.includes(searchQuery.toLowerCase())">
            <div class="app-icon app-icon-{{ mod.color }}">
                {% if mod.has_svg and mod.svg_path %}
                <img src="{{ mod.svg_path }}" alt="{{ mod.label }}" class="w-7 h-7">
                {% else %}
                {% icon mod.icon css_class="text-3xl" %}
                {% endif %}
            </div>
            <span class="text-sm font-medium">{{ mod.label }}</span>
        </a>
        {% endfor %}

        <!-- Get More -->
        <a class="card card-body items-center text-center gap-2 no-underline text-base-content opacity-50 hover:opacity-80 border-2 border-dashed cursor-pointer"
           href="/marketplace/"
           hx-get="/marketplace/"
           hx-target="#main-content-area"
           hx-push-url="true"
           x-show="!searchQuery"
           style="background: transparent;">
            <div class="app-icon" style="background: transparent;">
                {% icon "add" css_class="text-3xl" %}
            </div>
            <span class="text-sm font-medium">{% trans "Get More" %}</span>
        </a>
    </div>
    {% else %}
    <!-- Empty state -->
    <div class="flex flex-col items-center text-center py-12">
        {% icon "extension-puzzle-outline" css_class="w-16 h-16 opacity-30 mb-4" %}
        <h3 class="text-lg font-semibold mb-2">{% trans "No modules installed" %}</h3>
        <p class="opacity-60 mb-6">{% trans "Visit the Marketplace to add functionality to your Hub." %}</p>
        <a class="btn color-primary"
           href="/marketplace/"
           hx-get="/marketplace/"
           hx-target="#main-content-area"
           hx-push-url="true">
            {% icon "storefront-outline" %}
            {% trans "Browse Marketplace" %}
        </a>
    </div>
    {% endif %}
</div>
