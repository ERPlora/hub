{# File Input Component - Styled file picker with hidden native input #}
<div class="ui-file-input{% if css_class %} {{ css_class }}{% endif %}">
    <input
        type="file"
        name="{{ name }}"
        id="{{ input_id|default:name }}"
        {% if accept %}accept="{{ accept }}"{% endif %}
        {% if multiple %}multiple{% endif %}
        {% if required %}required{% endif %}
        {% if disabled %}disabled{% endif %}
        class="ui-file-input__native"
        onchange="updateFileInputLabel(this)"
    >
    <ion-button
        fill="{{ fill|default:'outline' }}"
        color="{{ color|default:'medium' }}"
        size="{{ size|default:'default' }}"
        {% if disabled %}disabled{% endif %}
        onclick="this.parentElement.querySelector('input[type=file]').click()">
        <ion-icon slot="start" name="{{ icon|default:'cloud-upload-outline' }}"></ion-icon>
        <span class="ui-file-input__label">{{ label|default:"Choose file" }}</span>
    </ion-button>
    {% if show_filename %}
    <span class="ui-file-input__filename" id="{{ input_id|default:name }}-filename"></span>
    {% endif %}
</div>

<style>
.ui-file-input {
    display: flex;
    align-items: center;
    gap: var(--space-sm, 8px);
    flex-wrap: wrap;
}

.ui-file-input__native {
    /* Completely hide the native file input */
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

.ui-file-input__filename {
    font-size: 13px;
    color: var(--ion-color-medium);
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ui-file-input__filename:empty {
    display: none;
}
</style>

<script>
function updateFileInputLabel(input) {
    const filenameSpan = document.getElementById(input.id + '-filename');
    if (filenameSpan) {
        if (input.files && input.files.length > 0) {
            if (input.files.length === 1) {
                filenameSpan.textContent = input.files[0].name;
            } else {
                filenameSpan.textContent = input.files.length + ' files selected';
            }
        } else {
            filenameSpan.textContent = '';
        }
    }
}
</script>
