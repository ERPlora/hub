{% load i18n ui component_tags %}
{#
    Page Component - Base structure for all module pages

    Generates a fragment with: content-header + page-content
    This fragment is swapped into #main-content-area (ion-content in app_base.html).

    The tabbar is sent separately via OOB swap to #global-tabbar.

    NOTE: Does NOT generate ion-page because it would be nested inside ion-content
    which is not allowed by Ionic. The outer ion-page is in app_base.html.

    Params:
        title: Page title
        subtitle: Optional subtitle
        page_module_id: Module ID for tabbar (sent via OOB)
        tabbar_view: Current view for active tab
        show_back: Show back button (default True)
        action_icon: Icon for header action
        action_label: Label for header action
        action_url: URL for header action (HTMX)
        padding: Add ion-padding to content
#}

{# Page Header (secondary - inside ion-content) #}
{% ui_page_header title=title subtitle=subtitle action_icon=action_icon action_label=action_label action_hx_get=action_url action_hx_target=action_hx_target action_hx_push_url="true" action_x_click=action_x_click show_back=show_back %}

{# CSRF token for JavaScript #}
{% csrf_token %}

{# Main content #}
<div class="page-content{% if padding %} ion-padding{% endif %}">
    {% slot "content" %}{% endslot %}
</div>

{# Tab bar - updated via JavaScript (no more OOB swap) #}
{% if page_module_id %}
    {% component "tabbar" module_id=page_module_id current_view=tabbar_view %}{% endcomponent %}
{% else %}
    {# No module = clear tabbar via JavaScript #}
    <script>
    (function() {
        if (typeof window.updateGlobalTabBar === 'function') {
            window.updateGlobalTabBar([]);
        }
    })();
    </script>
{% endif %}
