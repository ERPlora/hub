{% load i18n ui component_tags djicons %}
{#
    Settings Page Component - Para paginas de configuracion de modulos

    Genera estructura: content-header + page-content
    Se swappea en #main-content-area (div en app_base.html).
    El tabbar se actualiza via OOB swap cuando navegas entre modulos.

    Params:
        title: Titulo de la pagina
        module_id: ID del modulo (para tabbar)
        tabbar_view: Vista actual del tabbar
        alpine_app: Nombre de la app Alpine.js (opcional)
#}

{# Page Header #}
{% ui_page_header title=title %}

{# CSRF token for JavaScript/HTMX #}
{% csrf_token %}

{# Main Content #}
<div class="page-content ux-padding"{% if alpine_app %} x-data="{{ alpine_app }}()" x-init="init()"{% endif %}>
    {# Info slot - for read-only global config sections #}
    {% slot "info" %}{% endslot %}

    {# Main settings content #}
    <div class="ux-card" style="margin: 0;">
        <div class="ux-card__body">
            {% slot "settings" %}{% endslot %}

            {# Actions slot - for reset/save buttons #}
            {% slot "actions" %}{% endslot %}
        </div>
    </div>

    {# Footer info slot - for help text #}
    {% slot "footer" %}{% endslot %}
</div>

{# Tab bar via OOB swap #}
{% if render_tabbar and navigation %}
<footer id="global-tabbar-footer" class="ux-footer" hx-swap-oob="outerHTML:#global-tabbar-footer">
    <div id="global-tabbar" class="ux-tab-bar ux-tab-bar--bottom">
        {% for nav in navigation %}
        <button
            class="ux-tab-button{% if nav.id == tabbar_view %} ux-tab-button--selected{% endif %}"
            hx-get="{{ nav.url }}"
            hx-target="#main-content-area"
            hx-push-url="true">
            {% icon nav.icon %}
            <span class="ux-tab-button__label">{{ nav.label }}</span>
        </button>
        {% endfor %}
    </div>
</footer>
<script>document.body.setAttribute('data-module-id', '{{ module_id }}');</script>
{% elif render_tabbar and not module_id %}
{# HTMX to non-module page = clear tabbar #}
<footer id="global-tabbar-footer" class="ux-footer" hx-swap-oob="outerHTML:#global-tabbar-footer" style="display: none;">
    <div id="global-tabbar" class="ux-tab-bar ux-tab-bar--bottom"></div>
</footer>
<script>document.body.removeAttribute('data-module-id');</script>
{% endif %}
