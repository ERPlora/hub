{% load i18n ui component_tags %}
{#
    List Page Component - Para páginas de listado de módulos

    Genera estructura: content-header + page-content
    Se swappea en #main-content-area (div en app_base.html).
    El tabbar se actualiza via OOB swap cuando navegas entre módulos.

    NOTE: NO genera ion-page porque va dentro de #main-content-area.

    Params:
        title: Título de la página
        subtitle: Subtítulo opcional
        module_id: ID del módulo (para tabbar)
        tabbar_view: Vista actual del tabbar
        action_icon: Icono de acción en header
        action_label: Label de acción en header
        action_url: URL de acción en header
        action_hx_target: Target HTMX de acción
#}

{# Page Header (secondary - inside main-content-area) #}
{% ui_page_header title=title subtitle=subtitle action_icon=action_icon action_label=action_label action_hx_get=action_url action_hx_target=action_hx_target action_hx_push_url="true" %}

{# CSRF token for JavaScript #}
{% csrf_token %}

{# Main Content #}
<div class="page-content ion-padding">
    {# Optional Stats Section #}
    {% slot "stats" %}{% endslot %}

    {# Filters Section #}
    {% slot "filters" %}{% endslot %}

    {# Main Content (Table/List) #}
    {% slot "content" %}{% endslot %}
</div>

{# Tab bar via OOB swap - only when navigating between modules via HTMX #}
{# For full page loads, tabbar is rendered in app_base.html directly #}
{# For HTMX within same module, tabbar already correct #}
<!-- DEBUG: render_tabbar={{ render_tabbar }}, navigation_count={{ navigation|length }}, module_id={{ module_id }} -->
{% if render_tabbar and navigation %}
<ion-footer id="global-tabbar-footer" hx-swap-oob="outerHTML:#global-tabbar-footer">
    <ion-tab-bar id="global-tabbar">
        {% for nav in navigation %}
        <ion-tab-button
            hx-get="{{ nav.url }}"
            hx-target="#main-content-area"
            hx-push-url="true"
            class="{% if nav.id == tabbar_view %}tab-selected{% endif %}">
            <ion-icon name="{{ nav.icon }}"></ion-icon>
            <ion-label>{{ nav.label }}</ion-label>
        </ion-tab-button>
        {% endfor %}
    </ion-tab-bar>
</ion-footer>
<script>document.body.setAttribute('data-module-id', '{{ module_id }}');</script>
{% elif render_tabbar and not module_id %}
{# HTMX to non-module page = clear tabbar #}
<ion-footer id="global-tabbar-footer" hx-swap-oob="outerHTML:#global-tabbar-footer" style="display: none;">
    <ion-tab-bar id="global-tabbar"></ion-tab-bar>
</ion-footer>
<script>document.body.removeAttribute('data-module-id');</script>
{% endif %}
