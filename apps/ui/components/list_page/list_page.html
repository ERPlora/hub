{% load i18n ui component_tags djicons %}
{#
    List Page Component - Para paginas de listado de modulos

    Genera estructura: content-header + page-content
    Se swappea en #main-content-area (div en app_base.html).
    El tabbar se actualiza via OOB swap cuando navegas entre modulos.

    Params:
        title: Titulo de la pagina
        subtitle: Subtitulo opcional
        module_id: ID del modulo (para tabbar)
        tabbar_view: Vista actual del tabbar
        action_icon: Icono de accion en header
        action_label: Label de accion en header
        action_url: URL de accion en header
        action_hx_target: Target HTMX de accion
#}

{# Page Header #}
{% ui_page_header title=title subtitle=subtitle action_icon=action_icon action_label=action_label action_hx_get=action_url action_hx_target=action_hx_target action_hx_push_url="true" %}

{# CSRF token for JavaScript #}
{% csrf_token %}

{# Main Content #}
<div class="page-content ux-padding">
    {# Optional Stats Section #}
    {% slot "stats" %}{% endslot %}

    {# Filters Section #}
    {% slot "filters" %}{% endslot %}

    {# Main Content (Table/List) #}
    {% slot "content" %}{% endslot %}
</div>

{# Tab bar via OOB swap - only when navigating between modules via HTMX #}
{% if render_tabbar and navigation %}
<footer id="global-tabbar-footer" class="ux-footer" hx-swap-oob="outerHTML:#global-tabbar-footer">
    <div id="global-tabbar" class="ux-tab-bar ux-tab-bar--bottom">
        {% for nav in navigation %}
        <button
            class="ux-tab-button{% if nav.id == tabbar_view %} ux-tab-button--selected{% endif %}"
            hx-get="{{ nav.url }}"
            hx-target="#main-content-area"
            hx-push-url="true">
            {% icon nav.icon %}
            <span class="ux-tab-button__label">{{ nav.label }}</span>
        </button>
        {% endfor %}
    </div>
</footer>
<script>document.body.setAttribute('data-module-id', '{{ module_id }}');</script>
{% elif render_tabbar and not module_id %}
{# HTMX to non-module page = clear tabbar #}
<footer id="global-tabbar-footer" class="ux-footer" hx-swap-oob="outerHTML:#global-tabbar-footer" style="display: none;">
    <div id="global-tabbar" class="ux-tab-bar ux-tab-bar--bottom"></div>
</footer>
<script>document.body.removeAttribute('data-module-id');</script>
{% endif %}
