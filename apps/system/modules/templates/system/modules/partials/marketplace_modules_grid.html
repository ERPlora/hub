{% load i18n %}

{% if modules %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for module in modules %}
    <ion-card id="module-card-{{ module.slug }}">
        <ion-card-header>
            <div class="flex items-center gap-3">
                <ion-icon name="{{ module.icon|default:'cube-outline' }}" class="text-2xl text-primary"></ion-icon>
                <div class="flex-1 min-w-0">
                    <ion-card-title class="truncate">{{ module.name }}</ion-card-title>
                    <ion-card-subtitle>v{{ module.version }}</ion-card-subtitle>
                </div>
                {% if module.is_installed %}
                <ion-chip color="success">{% trans "Installed" %}</ion-chip>
                {% endif %}
            </div>
        </ion-card-header>
        <ion-card-content>
            <p class="text-sm text-medium mb-4 line-clamp-2">{{ module.description }}</p>
            <div class="flex justify-between items-center text-xs text-medium">
                <span>{{ module.author }}</span>
                <span>
                    {% if module.is_free %}
                        {% trans "Free" %}
                    {% else %}
                        {{ module.price }} {{ module.currency|default:"EUR" }}
                    {% endif %}
                </span>
            </div>
        </ion-card-content>
        <div class="flex border-t border-gray-200 dark:border-gray-700">
            {% if module.is_installed %}
            <ion-button fill="clear" size="small" color="medium" class="flex-1" disabled>
                <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
                {% trans "Installed" %}
            </ion-button>
            {% else %}
                {% if module.is_free %}
                <ion-button
                    fill="clear"
                    size="small"
                    color="primary"
                    class="flex-1"
                    onclick="installFreeModule('{{ module.id }}', '{{ module.slug }}', '{{ module.download_url|default:'' }}', this)">
                    <ion-spinner name="crescent" class="install-spinner mr-2" style="display: none;"></ion-spinner>
                    <ion-icon slot="start" name="download-outline" class="install-icon"></ion-icon>
                    {% trans "Install" %}
                </ion-button>
                {% else %}
                <ion-button
                    fill="clear"
                    size="small"
                    color="primary"
                    class="flex-1"
                    onclick="purchaseModule('{{ module.id }}', this)">
                    <ion-spinner name="crescent" class="install-spinner mr-2" style="display: none;"></ion-spinner>
                    <ion-icon slot="start" name="cart-outline" class="install-icon"></ion-icon>
                    {% trans "Purchase" %}
                </ion-button>
                {% endif %}
            {% endif %}
        </div>
    </ion-card>
    {% endfor %}
</div>
{% else %}
<!-- Empty State -->
<ion-card>
    <ion-card-content class="text-center py-8">
        <ion-icon name="search-outline" class="text-6xl text-medium mb-4"></ion-icon>
        <h3 class="text-lg font-semibold mb-2">{% trans "No modules found" %}</h3>
        <p class="text-medium">{% trans "Try adjusting your search or filters" %}</p>
    </ion-card-content>
</ion-card>
{% endif %}
