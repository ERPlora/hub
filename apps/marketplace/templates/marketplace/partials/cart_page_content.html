{% load i18n djicons %}

<div hidden data-back-url="/marketplace/"></div>

{% if cart.items %}
        <div class="card m-0 mb-lg">
            <div class="card-body">
                <div class="list" id="cart-items">
                    {% for item in cart.items %}
                    <div class="list-item flex items-center gap-4">
                        <span style="font-size: 28px; color: var(--color-primary);">
                            {% icon item.icon|default:"cube-outline" %}
                        </span>
                        <div class="flex-1">
                            <h2 class="fw-semibold">{{ item.name }}</h2>
                            <p class="text-medium">{{ item.description|truncatechars:60 }}</p>
                        </div>
                        <div class="d-flex align-center gap-sm">
                            {% if item.price == 0 %}
                            <span class="chip color-success">{% trans "Free" %}</span>
                            {% else %}
                            <span class="fw-semibold">{{ item.price|floatformat:2 }} EUR</span>
                            {% if item.quantity > 1 %}
                            <span class="text-medium">x {{ item.quantity }}</span>
                            {% endif %}
                            {% endif %}
                            <button
                                class="btn btn-ghost color-error"
                                hx-delete="{% url 'marketplace:cart_remove' item.id %}"
                                hx-target="#main-content-area"
                                hx-push-url="false">
                                {% icon "trash-outline" %}
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Cart Summary -->
        <div class="card m-0 mb-lg">
            <div class="card-body">
                <div class="d-flex justify-between align-center mb-md">
                    <span class="fs-lg">{% trans "Subtotal" %}</span>
                    <span class="fs-lg fw-semibold">
                        {% if cart.subtotal == 0 %}
                        {% trans "Free" %}
                        {% else %}
                        {{ cart.subtotal|floatformat:2 }} EUR
                        {% endif %}
                    </span>
                </div>

                {% if cart.tax > 0 %}
                <div class="d-flex justify-between align-center mb-md text-medium">
                    <span>{% trans "Tax" %} ({{ cart.tax_rate }}%)</span>
                    <span>{{ cart.tax|floatformat:2 }} EUR</span>
                </div>
                {% endif %}

                <div class="d-flex justify-between align-center pt-md" style="border-top: 2px solid var(--color-primary);">
                    <span class="fs-xl fw-bold">{% trans "Total" %}</span>
                    <span class="fs-xl fw-bold text-primary">
                        {% if cart.total == 0 %}
                        {% trans "Free" %}
                        {% else %}
                        {{ cart.total|floatformat:2 }} EUR
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <button class="btn btn-block btn-lg mb-4">
            {% icon "card-outline" %}
            {% trans "Proceed to Checkout" %}
        </button>

        <button
            class="btn btn-block btn-outline color-error"
            hx-delete="{% url 'marketplace:cart_clear' %}"
            hx-target="#main-content-area"
            hx-push-url="false">
            {% icon "trash-outline" %}
            {% trans "Clear Cart" %}
        </button>

        {% else %}
        <!-- Empty Cart State -->
        <div class="ui-empty-state">
            {% icon "cart-outline" css_class="ui-empty-state-icon" %}
            <h3 class="ui-empty-state-title">{% trans "Your cart is empty" %}</h3>
            <p class="ui-empty-state-description">{% trans "Browse the marketplace to find modules and services for your Hub." %}</p>
            <button class="btn"
                hx-get="{% url 'marketplace:index' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
                {% icon "storefront-outline" %}
                {% trans "Browse Marketplace" %}
            </button>
        </div>
        {% endif %}

        <!-- Info Footer -->
        <div class="mt-lg p-md rounded-lg" style="background: var(--bg-color-secondary);">
            <div class="d-flex align-start gap-sm">
                {% icon "information-circle-outline" style="font-size: 20px; color: var(--color-primary); flex-shrink: 0; margin-top: 2px;" %}
                <p class="fs-sm text-secondary m-0">
                    {% trans "All modules include a 15-day free trial. You won't be charged until the trial period ends." %}
                </p>
            </div>
        </div>
