{% load i18n djicons %}

<div class="ux-cart">
    {% if cart.items %}
    {# Cart Header #}
    <div class="ux-cart__header">
        <h2 class="ux-cart__title">
            {% icon "cart-outline" %}
            {% trans "Shopping Cart" %}
            <span class="ux-cart__count">{{ cart.items|length }}</span>
        </h2>
        <button type="button"
                class="ux-cart__clear"
                hx-delete="{% url 'marketplace:cart_clear' store_type %}"
                hx-target="#cart-content"
                hx-swap="innerHTML"
                hx-confirm="{% trans 'Are you sure you want to clear your cart?' %}">
            {% icon "trash-outline" %}
            <span>{% trans "Clear" %}</span>
        </button>
    </div>

    {# Cart Items #}
    <div class="ux-cart__items">
        <ul class="ux-cart__items-list">
            {% for item in cart.items %}
            <li class="ux-cart-item">
                {# Item Icon #}
                <div class="ux-cart-item__image-placeholder">
                    {% icon item.icon|default:"cube-outline" %}
                </div>

                {# Item Content #}
                <div class="ux-cart-item__content">
                    <h3 class="ux-cart-item__name">{{ item.name }}</h3>
                    {% if item.quantity > 1 %}
                    <p class="ux-cart-item__meta">{% trans "Qty:" %} {{ item.quantity }}</p>
                    {% endif %}
                    {% if item.price > 0 %}
                    <span class="ux-cart-item__unit-price">&euro;{{ item.price }} {% trans "each" %}</span>
                    {% endif %}
                </div>

                {# Item Price #}
                <div class="ux-cart-item__price">
                    {% if item.price == 0 %}
                    <span style="color: var(--ux-success);">{% trans "Free" %}</span>
                    {% else %}
                    &euro;{% widthratio item.price 1 item.quantity %}
                    {% endif %}
                </div>

                {# Remove Button #}
                <button type="button"
                        class="ux-cart-item__remove"
                        hx-delete="{% url 'marketplace:cart_remove' store_type item.id %}"
                        hx-target="#cart-content"
                        hx-swap="innerHTML"
                        title="{% trans 'Remove' %}">
                    {% icon "trash-outline" %}
                </button>
            </li>
            {% endfor %}
        </ul>
    </div>

    {# Cart Summary #}
    <div class="ux-cart-summary">
        <div class="ux-cart-summary__row ux-cart-summary__row--total">
            <span class="ux-cart-summary__label">{% trans "Total" %}</span>
            <span class="ux-cart-summary__value">
                {% if cart.total == 0 %}
                {% trans "Free" %}
                {% else %}
                &euro;{{ cart.total|floatformat:2 }}
                {% endif %}
            </span>
        </div>
    </div>

    {# Cart Actions #}
    <div class="ux-cart__actions">
        <button type="button"
                class="ux-button ux-button--lg ux-color-primary"
                onclick="checkoutCart()">
            {% icon "card-outline" %}
            <span>{% trans "Checkout" %}</span>
        </button>
        <button type="button"
                class="ux-button ux-button--outline"
                hx-get="{% url 'marketplace:index' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
            {% icon "arrow-back-outline" %}
            <span>{% trans "Continue Shopping" %}</span>
        </button>
    </div>

    {% else %}
    {# Empty Cart State #}
    <div class="ux-cart__empty">
        <div class="ux-cart__empty-icon">
            {% icon "cart-outline" %}
        </div>
        <h3 class="ux-cart__empty-title">{% trans "Your cart is empty" %}</h3>
        <p class="ux-cart__empty-text">{% trans "Add items from the marketplace to get started" %}</p>
        <button type="button"
                class="ux-button ux-color-primary mt-lg"
                hx-get="{% url 'marketplace:index' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
            {% icon "storefront-outline" %}
            <span>{% trans "Browse Marketplace" %}</span>
        </button>
    </div>
    {% endif %}
</div>

<script>
function checkoutCart() {
    // TODO: Implement checkout flow
    Toast.info('{% trans "Checkout coming soon!" %}');
}
</script>
