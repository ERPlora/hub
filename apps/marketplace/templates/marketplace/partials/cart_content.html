{% load i18n djicons %}

<div class="cart-container">
    {% if cart.items %}
    <ion-list lines="full">
        {% for item in cart.items %}
        <ion-item-sliding>
            <ion-item>
                {% icon item.icon slot="start" color="primary" %}
                <ion-label>
                    <h3>{{ item.name }}</h3>
                    <p>
                        {% if item.price == 0 %}
                        <ion-text color="success">{% trans "Free" %}</ion-text>
                        {% else %}
                        {{ item.price }} EUR {% if item.quantity > 1 %}x {{ item.quantity }}{% endif %}
                        {% endif %}
                    </p>
                </ion-label>
                <ion-button
                    fill="clear"
                    color="danger"
                    slot="end"
                    hx-delete="{% url 'marketplace:cart_remove' store_type item.id %}"
                    hx-target="#cart-content"
                    hx-swap="innerHTML">
                    {% icon "trash-outline" slot="icon-only" %}
                </ion-button>
            </ion-item>
            <ion-item-options side="end">
                <ion-item-option
                    color="danger"
                    hx-delete="{% url 'marketplace:cart_remove' store_type item.id %}"
                    hx-target="#cart-content"
                    hx-swap="innerHTML">
                    {% icon "trash" slot="icon-only" %}
                </ion-item-option>
            </ion-item-options>
        </ion-item-sliding>
        {% endfor %}
    </ion-list>

    <!-- Cart Summary -->
    <div class="ion-padding cart-summary">
        <ion-grid>
            <ion-row class="ion-align-items-center">
                <ion-col>
                    <strong>{% trans "Total" %}</strong>
                </ion-col>
                <ion-col size="auto">
                    <ion-text color="primary">
                        <strong>
                            {% if cart.total == 0 %}
                            {% trans "Free" %}
                            {% else %}
                            {{ cart.total|floatformat:2 }} EUR
                            {% endif %}
                        </strong>
                    </ion-text>
                </ion-col>
            </ion-row>
        </ion-grid>
    </div>

    <!-- Cart Actions -->
    <div class="ion-padding">
        <ion-button expand="block" color="primary" onclick="checkoutCart()">
            {% icon "card-outline" slot="start" %}
            {% trans "Checkout" %}
        </ion-button>

        <ion-button
            expand="block"
            fill="outline"
            color="danger"
            class="ion-margin-top"
            hx-delete="{% url 'marketplace:cart_clear' store_type %}"
            hx-target="#cart-content"
            hx-swap="innerHTML">
            {% icon "trash-outline" slot="start" %}
            {% trans "Clear Cart" %}
        </ion-button>
    </div>

    {% else %}
    <!-- Empty Cart -->
    <div class="ion-padding ion-text-center empty-cart">
        {% icon "cart-outline" style="font-size: 64px; color: var(--ion-color-medium);" %}
        <h3>{% trans "Your cart is empty" %}</h3>
        <p class="text-medium">{% trans "Add items from the marketplace to get started" %}</p>
        <ion-button fill="clear" onclick="menuController.close('cart-menu')">
            {% icon "storefront-outline" slot="start" %}
            {% trans "Browse Marketplace" %}
        </ion-button>
    </div>
    {% endif %}
</div>

<script>
function checkoutCart() {
    // TODO: Implement checkout flow
    Toast.info('{% trans "Checkout coming soon!" %}');
}
</script>

<style>
.cart-container {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.cart-summary {
    background: var(--ion-color-light);
    border-top: 1px solid var(--ion-color-light-shade);
    margin-top: auto;
}

.empty-cart {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    padding-top: 60px;
}
</style>
