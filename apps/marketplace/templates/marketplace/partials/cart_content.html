{% load i18n djicons %}

<div class="cart">
    {% if cart.items %}
    {# Cart Header #}
    <div class="cart-header">
        <h2>
            {% icon "cart-outline" %}
            {% trans "Shopping Cart" %}
            <span class="badge">{{ cart.items|length }}</span>
        </h2>
        <button type="button"
                class="btn btn-ghost btn-sm"
                hx-delete="{% url 'marketplace:cart_clear' %}"
                hx-target="#cart-content"
                hx-swap="innerHTML"
                hx-confirm="{% trans 'Are you sure you want to clear your cart?' %}">
            {% icon "trash-outline" %}
            <span>{% trans "Clear" %}</span>
        </button>
    </div>

    {# Cart Items #}
    <div class="cart-items">
        <ul>
            {% for item in cart.items %}
            <li class="cart-item">
                {# Item Icon #}
                <div class="flex items-center justify-center">
                    {% icon item.icon|default:"cube-outline" %}
                </div>

                {# Item Content #}
                <div class="cart-item-content">
                    <h3 class="cart-item-name">{{ item.name }}</h3>
                    {% if item.quantity > 1 %}
                    <p class="cart-item-meta">{% trans "Qty:" %} {{ item.quantity }}</p>
                    {% endif %}
                    {% if item.price > 0 %}
                    <span class="cart-item-unit">&euro;{{ item.price }} {% trans "each" %}</span>
                    {% endif %}
                </div>

                {# Item Price #}
                <div class="cart-item-price">
                    {% if item.price == 0 %}
                    <span style="color: var(--color-success);">{% trans "Free" %}</span>
                    {% else %}
                    &euro;{% widthratio item.price 1 item.quantity %}
                    {% endif %}
                </div>

                {# Remove Button #}
                <button type="button"
                        class="btn btn-ghost btn-sm"
                        hx-delete="{% url 'marketplace:cart_remove' item.id %}"
                        hx-target="#cart-content"
                        hx-swap="innerHTML"
                        title="{% trans 'Remove' %}">
                    {% icon "trash-outline" %}
                </button>
            </li>
            {% endfor %}
        </ul>
    </div>

    {# Cart Summary #}
    <div class="cart-summary">
        <div class="cart-summary-row">
            <span>{% trans "Total" %}</span>
            <span class="cart-summary-value">
                {% if cart.total == 0 %}
                {% trans "Free" %}
                {% else %}
                &euro;{{ cart.total|floatformat:2 }}
                {% endif %}
            </span>
        </div>
    </div>

    {# Cart Actions #}
    <div class="cart-actions">
        <button type="button"
                class="btn btn-lg color-primary"
                onclick="checkoutCart()">
            {% icon "card-outline" %}
            <span>{% trans "Checkout" %}</span>
        </button>
        <button type="button"
                class="btn btn-outline"
                hx-get="{% url 'marketplace:index' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
            {% icon "arrow-back-outline" %}
            <span>{% trans "Continue Shopping" %}</span>
        </button>
    </div>

    {% else %}
    {# Empty Cart State #}
    <div class="flex flex-col items-center justify-center py-8">
        <div>
            {% icon "cart-outline" %}
        </div>
        <h3>{% trans "Your cart is empty" %}</h3>
        <p class="text-base-content/60">{% trans "Add items from the marketplace to get started" %}</p>
        <button type="button"
                class="btn color-primary mt-6"
                hx-get="{% url 'marketplace:index' %}"
                hx-target="#main-content-area"
                hx-push-url="true">
            {% icon "storefront-outline" %}
            <span>{% trans "Browse Marketplace" %}</span>
        </button>
    </div>
    {% endif %}
</div>

<script>
function checkoutCart() {
    // TODO: Implement checkout flow
    Toast.info('{% trans "Checkout coming soon!" %}');
}
</script>
