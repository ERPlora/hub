{% load i18n djicons %}

{# Breadcrumbs #}
<div class="d-flex align-center gap-xs mb-md fs-sm flex-wrap">
    {% for crumb in breadcrumbs %}
    {% if not forloop.last %}
    <a href="#"
       hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ crumb.path }}"
       hx-target="#file-browser-content"
       class="text-primary">
        {{ crumb.name }}
    </a>
    {% icon "chevron-forward-outline" css_class="text-secondary" %}
    {% else %}
    <span class="fw-semibold">{{ crumb.name }}</span>
    {% endif %}
    {% endfor %}
</div>

{# Directory Tabs #}
<div class="d-flex gap-xs mb-md overflow-x-auto pb-xs">
    {% for key, dir_info in directories.items %}
    <ion-chip
        {% if key == dir_key %}color="primary"{% else %}color="medium"{% endif %}
        class="cursor-pointer"
        hx-get="{% url 'configuration:file_browser' %}?dir={{ key }}"
        hx-target="#file-browser-content">
        {% icon dir_info.icon|add:"-outline" %}
        <ion-label>{{ dir_info.name }}</ion-label>
    </ion-chip>
    {% endfor %}
</div>

{# Back Button #}
{% if has_parent %}
<ion-item button
    hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ parent_path }}"
    hx-target="#file-browser-content"
    class="mb-xs">
    {% icon "arrow-back-outline" slot="start" %}
    <ion-label>{% trans "Back" %}</ion-label>
</ion-item>
{% endif %}

{# Files List #}
{% if is_empty %}
<div class="table-empty">
    {% icon "folder-open-outline" css_class="table-empty-icon" %}
    <p class="text-secondary">{% trans "No files in this directory" %}</p>
</div>
{% else %}
<ion-list>
    {% for item in items %}
    {% if item.is_dir %}
    {# Directory #}
    <ion-item button
        hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ item.path }}"
        hx-target="#file-browser-content">
        {% icon "folder" slot="start" color="warning" %}
        <ion-label>
            <h3>{{ item.name }}</h3>
            <p class="fs-xs text-secondary">{{ item.modified }}</p>
        </ion-label>
    </ion-item>
    {% else %}
    {# File #}
    <ion-item>
        {% icon item.icon|add:"-outline" slot="start" color="medium" %}
        <ion-label>
            <h3>{{ item.name }}</h3>
            <p class="fs-xs text-secondary">{{ item.size }} &bull; {{ item.modified }}</p>
        </ion-label>
        <ion-button
            fill="clear"
            slot="end"
            href="{% url 'configuration:download_file' %}?dir={{ dir_key }}&path={{ item.path }}"
            download>
            {% icon "download-outline" slot="icon-only" %}
        </ion-button>
    </ion-item>
    {% endif %}
    {% endfor %}
</ion-list>
{% endif %}
