{% load i18n djicons %}

{# Breadcrumbs #}
<div class="d-flex align-center gap-xs mb-md fs-sm flex-wrap">
    {% for crumb in breadcrumbs %}
    {% if not forloop.last %}
    <a href="#"
       hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ crumb.path }}"
       hx-target="#file-browser-content"
       class="text-primary">
        {{ crumb.name }}
    </a>
    {% icon "chevron-forward-outline" css_class="text-secondary" %}
    {% else %}
    <span class="fw-semibold">{{ crumb.name }}</span>
    {% endif %}
    {% endfor %}
</div>

{# Directory Tabs #}
<div class="d-flex gap-xs mb-md overflow-x-auto pb-xs">
    {% for key, dir_info in directories.items %}
    <span class="chip {% if key == dir_key %}color-primary{% endif %}"
        style="cursor: pointer;"
        hx-get="{% url 'configuration:file_browser' %}?dir={{ key }}"
        hx-target="#file-browser-content">
        {% icon dir_info.icon|add:"-outline" %}
        <span>{{ dir_info.name }}</span>
    </span>
    {% endfor %}
</div>

{# Back Button #}
{% if has_parent %}
<div class="list-item mb-xs" style="cursor: pointer;"
    hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ parent_path }}"
    hx-target="#file-browser-content">
    {% icon "arrow-back-outline" %}
    <span>{% trans "Back" %}</span>
</div>
{% endif %}

{# Files List #}
{% if is_empty %}
<div class="table-empty">
    {% icon "folder-open-outline" css_class="table-empty-icon" %}
    <p class="text-secondary">{% trans "No files in this directory" %}</p>
</div>
{% else %}
<div class="list">
    {% for item in items %}
    {% if item.is_dir %}
    {# Directory #}
    <div class="list-item" style="cursor: pointer;"
        hx-get="{% url 'configuration:file_browser' %}?dir={{ dir_key }}&path={{ item.path }}"
        hx-target="#file-browser-content">
        <span style="color: var(--color-warning);">{% icon "folder" %}</span>
        <div class="flex-1">
            <h3>{{ item.name }}</h3>
            <p class="fs-xs text-secondary">{{ item.modified }}</p>
        </div>
    </div>
    {% else %}
    {# File #}
    <div class="list-item d-flex align-center gap-sm">
        <span style="color: var(--color-base-content-secondary);">{% icon item.icon|add:"-outline" %}</span>
        <div class="flex-1">
            <h3>{{ item.name }}</h3>
            <p class="fs-xs text-secondary">{{ item.size }} &bull; {{ item.modified }}</p>
        </div>
        <a class="btn btn-ghost"
            href="{% url 'configuration:download_file' %}?dir={{ dir_key }}&path={{ item.path }}"
            download>
            {% icon "download-outline" %}
        </a>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endif %}
