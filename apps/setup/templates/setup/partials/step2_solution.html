{% load i18n djicons %}

{% include "setup/partials/stepper.html" %}

{% if errors %}
<div class="callout callout-warning mb-4">
    {% for error in errors %}
    <p>{% icon "alert-circle-outline" %} {{ error }}</p>
    {% endfor %}
</div>
{% endif %}

<div class="stepper-content">
    <h2 class="text-xl font-semibold mb-1">{% trans "Choose Your Solution" %}</h2>
    <p class="text-sm opacity-60 mb-6">{% trans "Select the solution that best fits your business" %}</p>

    <form hx-post="{% url 'setup:step' step=2 %}"
          hx-target="#wizard-step-content"
          hx-swap="innerHTML"
          x-data="{ selected: '{{ hub_config.solution_slug|default:'' }}', selectedName: '{{ hub_config.solution_name|default:'' }}' }">
        {% csrf_token %}
        <input type="hidden" name="solution_slug" :value="selected">
        <input type="hidden" name="solution_name" :value="selectedName">

        {% if solutions %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            {% for solution in solutions %}
            <div class="card cursor-pointer transition-all duration-150"
                 :class="selected === '{{ solution.slug }}' ? 'ring-2 ring-primary border-primary' : 'hover:border-base-content/20'"
                 @click="selected = '{{ solution.slug }}'; selectedName = '{{ solution.name }}'">
                <div class="card-body p-4">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="flex items-center justify-center w-10 h-10 rounded-lg"
                             style="background-color: {{ solution.color }}20; color: {{ solution.color }}">
                            {% icon solution.icon %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-semibold text-sm">{{ solution.name }}</h3>
                            {% if solution.industry_name %}
                            <span class="text-xs opacity-50">{{ solution.industry_name }}</span>
                            {% endif %}
                        </div>
                        <div class="size-5 rounded-full border-2 flex items-center justify-center shrink-0"
                             :class="selected === '{{ solution.slug }}' ? 'border-primary bg-primary text-white' : 'border-base-300'">
                            <svg x-show="selected === '{{ solution.slug }}'" class="size-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                    </div>
                    {% if solution.tagline %}
                    <p class="text-xs opacity-60 line-clamp-2">{{ solution.tagline }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="callout callout-info">
            <div class="callout-content">
                <p class="callout-text">{% trans "Could not load solutions. Please check your internet connection and try again." %}</p>
            </div>
        </div>
        {% endif %}

        <div class="stepper-actions">
            <div class="stepper-actions-start">
                <button type="button"
                        class="btn btn-outline"
                        hx-get="{% url 'setup:step' step=1 %}"
                        hx-target="#wizard-step-content"
                        hx-swap="innerHTML">
                    {% icon "arrow-back-outline" %}
                    {% trans "Back" %}
                </button>
            </div>
            <div class="stepper-actions-end">
                <button type="submit" class="btn color-primary" :disabled="!selected">
                    {% trans "Continue" %}
                    {% icon "arrow-forward-outline" %}
                </button>
            </div>
        </div>
    </form>
</div>
